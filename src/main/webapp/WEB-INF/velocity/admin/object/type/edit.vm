#parse("/admin/header.vm")


<h3>Edit Type: $type.name</h3>

<form class="form-horizontal" method="POST">

    <div class="control-group">
        <label class="control-label">Name</label>

        <div class="controls">
            #springFormInput("type.name")
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Prices</label>

        <div class="controls">
            #springFormCheckbox("type.prices")
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Link Groups</label>

        <div class="controls">
            #springFormTextarea("type.linkGroups", "class='input-block-level' rows='8'")
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Object List Markup</label>

        <div class="controls">
            <select id="objectListMarkup" name="objectListMarkup">
                #foreach($option in $markupMap.keySet())
                    <option value="${option}"
                        #if("$!type.objectListMarkup.id" == "$option")
                            selected="selected"
                        #end>
                        ${markupMap.get($option)}</option>
                #end
            </select>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label">Object View Markup</label>

        <div class="controls">
            <select id="objectViewMarkup" name="objectViewMarkup">
                #foreach($option in $markupMap.keySet())
                    <option value="${option}"
                        #if("$!type.objectViewMarkup.id" == "$option")
                            selected="selected"
                        #end>
                        ${markupMap.get($option)}</option>
                #end
            </select>
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save changes</button>
    </div>

</form>


<a href="$urlResolver.createAttribute($type)" role="button" class="btn"> <i class="icon-plus"></i> Create Attribute</a>


<table class="table table-condensed table-striped table-hover" id="attributes-table">
    <tr>
        <th>Id</th>
        <th>Section</th>
        <th>Name</th>
        <th>Type</th>
        <th></th>
    </tr>
    #foreach ($a in $attributes)
        <tr class="attribute-row" data-attribute-id="$a.id">
            <td>$a.id</td>
            <td>$!a.section</td>
            <td>$a.name</td>
            <td>$!a.attributeType</td>
            <td>
                <a href="$urlResolver.attributeEdit($a)" role="button" class="btn btn-mini">
                    <i class="icon-pencil"></i></a>
            </td>
        </tr>
    #end
</table>


<script>
    $(function () {
        $("#attributes-table tbody").sortable({

            update: function (event, ui) {
                var order = []
                $("#attributes-table tr.attribute-row").each(function (v) {
                    var id = $(this).attr("data-attribute-id")
                    order.push(id)
                })

                $.ajax({
                    type: "POST",
                    url: "/backoffice/type/$type.id/attribute/order",
                    contentType: "text/plain",
                    data: order.join('-')
                });
            }
        });
        $("#attributes-table tbody").disableSelection();
    });
</script>

<legend>Sections</legend>
<table class="table table-condensed table-hover" id="sections-table">
    <tr>
        <th>Name</th>
        <th>Description</th>
        <th></th>
    </tr>
    #foreach ($s in $sections)
        <tr data-section-id="$s.id" class="section-row">
            <td>$!s.name()</td>
            <td>$s.desc()</td>
            <td>
                <a href="$s.backoffice()" role="button" class="btn btn-mini">
                    <i class="icon-pencil"></i></a>

                <a href="/backoffice/type/$type.id/section/$s.id/delete" role="button"
                   class="btn btn-mini btn-danger">
                    <i class="icon-trash icon-white"></i></a>
            </td>
        </tr>
    #end
</table>

<form method="POST" action="/backoffice/type/$type.id/section/create">
    Add Section:
    <select name="class">
        #foreach($class in $classes.keySet())
            <option value="${class}">${classes.get($class)}</option>
        #end
    </select>
    <button type="submit">Submit</button>
</form>

#parse("/admin/footer.vm")